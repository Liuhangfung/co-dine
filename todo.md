# 健康餐廳菜式管理系統 - 項目待辦清單

## 數據庫設計與後端API
- [x] 設計食譜數據表結構(食材、步驟、營養資訊、分類)
- [x] 設計分類系統表結構(主要食材、菜系、烹調方法、健康標籤)
- [x] 創建食譜CRUD API
- [x] 創建分類管理API
- [x] 實現文件上傳功能(圖片/影片到S3)

## AI分析功能整合
- [x] 整合AI圖片分析功能(識別食材和步驟)
- [x] 整合AI影片分析功能(從網址提取內容)
- [x] 實現營養成分自動計算
- [x] 實現米芝蓮級改良建議生成
- [x] 生成適合煮食機械的標準化格式

## 前端介面開發
- [x] 設計整體UI風格和配色方案
- [x] 創建食譜列表頁面
- [x] 創建食譜詳情頁面
- [x] 實現三種輸入方式界面:
  - [x] Web link輸入表單
  - [x] 圖片上傳功能
  - [x] 手工輸入表單
- [ ] 創建分類瀏覽頁面
- [ ] 實現搜索和篩選功能
- [x] 創建儀表板展示統計數據

## 測試與優化
- [x] 編寫後端API單元測試
- [x] 測試AI分析準確性
- [x] 測試三種輸入方式
- [x] 優化用戶體驗和響應速度
- [x] 創建項目檢查點

## 文檔與部署
- [ ] 編寫用戶使用手冊
- [ ] 準備演示數據
- [ ] 最終測試和驗收

## Bug修復
- [x] 修復網址連結讀取錯誤(小紅書等網站)
- [x] 改進網址內容提取邏輯
- [x] 測試不同網站的食譜連結

## 用戶建議功能
- [x] 設計用戶建議數據表結構
- [x] 實現提交改良建議API
- [x] 實現根據建議重新分析食譜API
- [x] 創建建議輸入界面
- [x] 顯示改良前後對比
- [x] 測試建議功能

## 系統錯誤修復
- [x] 檢查TypeScript編譯錯誤
- [x] 檢查運行時錯誤
- [x] 檢查數據庫查詢錯誤
- [x] 檢查前端UI錯誤
- [x] 修復所有發現的問題(路由404問題)
- [x] 全面測試修復後的系統

## 公開食譜瀏覽頁面
- [x] 創建公開食譜列表API(支援篩選和搜索)
- [x] 實現分類篩選功能
- [x] 實現關鍵字搜索功能
- [x] 實現營養範圍篩選功能
- [x] 創建公開瀏覽頁面UI
- [x] 測試所有篩選功能

## 添加刪除食譜功能
- [x] 檢查並確認刪除API存在
- [x] 在儀表板頁面添加刪除按鈕
- [x] 添加刪除確認對話框
- [x] 測試刪除功能

## 添加食譜編輯功能
- [x] 檢查並完善編輯API(食材、步驟、分類)
- [x] 創建編輯食譜表單組件
- [x] 在食譜詳情頁添加編輯按鈕
- [x] 實現編輯模式切換
- [x] 測試編輯功能

## 添加版本歷史記錄功能
- [x] 設計版本歷史數據表結構
- [x] 實現自動記錄版本API
- [x] 實現查看版本歷史API
- [x] 實現還原到指定版本API
- [x] 創建版本歷史查看界面
- [x] 在編輯保存時自動記錄版本
- [x] 測試版本記錄和還原功能

## 添加評分和評論功能
- [x] 設計評分和評論數據表結構
- [x] 實現添加評分和評論API
- [x] 實現查看評分和評論API
- [x] 實現編輯和刪除評論API
- [x] 創建星級評分組件
- [x] 創建評論列表和表單組件
- [x] 在食譜詳情頁顯示評分和評論
- [x] 在瀏覽頁面顯示平均評分
- [x] 測試評分和評論功能

## 添加營養分析詳細顯示功能
- [x] 在食譜詳情頁添加營養好處分析區塊
- [x] 實現營養壞處警告提示
- [x] 添加健康評分計算邏輯
- [x] 添加推薦食用人群標籤
- [x] 測試營養分析功能

## 添加烹飪時間、難度和廚具指標
- [x] 更新数据库架構（添加難度、烹飪時間、所需廚具字段）
- [x] 更新后端 API（支持新字段的创建和更新）
- [x] 更新前端食譜詳情頁面（顯示新指標）
- [x] 更新編輯表單（允許編輯新字段）
- [x] 測試新功能

## 添加原始來源信息顯示
- [x] 在食譜詳情頁面頂部添加原始來源區塊
- [x] 顯示輸入方式（網址連結、圖片上傳、手動輸入）
- [x] 如果是網址連結，顯示原始連結並提供打開連結的按鈕
- [x] 測試原始來源信息顯示功能

## 開發食譜對比功能
- [x] 創建食譜對比頁面組件
- [x] 添加食譜對比路由
- [x] 實現食譜選擇器（支持多選）
- [x] 設計並排對比界面（營養成分、做法、烹飪信息）
- [x] 添加健康評分對比
- [x] 在食譜詳情頁面添加「加入對比」按鈕
- [x] 創建浮動對比按鈕組件
- [x] 測試食譜對比功能

## 實現智能版本管理和營養重算功能
- [x] 分析當前編輯功能和版本管理流程
- [x] 實現食材變更檢測邏輯
- [x] 實現營養成分自動重新計算（調用 AI API）
- [x] 生成變更對比視圖（修改前後對比）
- [x] 在保存後自動顯示對比對話框
- [x] 測試智能版本管理功能

## 為食譜對比功能增加視覺化圖表
- [x] 安裝 Recharts 圖表庫
- [x] 為營養對比對話框添加柱狀圖
- [x] 為營養對比對話框添加雷達圖
- [x] 為食譜對比頁面添加營養成分對比圖表
- [x] 實現顏色編碼（增加/減少）
- [x] 測試圖表功能

## 深度測試並修復網頁連結讀取功能
- [ ] 測試 YouTube 食譜影片連結
- [ ] 測試公開食譜網站連結（如 AllRecipes、Food Network）
- [ ] 測試小紅書連結（預期失敗，提供替代方案）
- [x] 識別所有問題：
  - [x] NaN 錯誤（caloriesPerServing 當 servings=0 時）
  - [x] TypeScript 類型錯誤（EditRecipeDialog.tsx 和 server/routers.ts）
  - [ ] AI 解析失敗
  - [ ] 網頁內容提取不完整
- [x] 修復所有發現的問題：
  - [x] 修復 NaN 錯誤：在所有 caloriesPerServing 計算中添加零除檢查
  - [x] 修復 TypeScript 錯誤：
    - [x] 修復 EditRecipeDialog.tsx 中 requiredEquipment 的類型轉換
    - [x] 修復 server/routers.ts 中 requiredEquipment 的類型聲明
    - [x] 添加 InsertRecipe 類型導入
- [x] 編寫完整的測試用例
- [x] 重新測試驗證修復
- [x] 確保所有測試通過（9 個測試通過，3 個跳過）

## 優化網址連結讀取功能的精準度和完整性
- [x] 分析當前網頁抓取策略的問題
- [x] 檢查 AI 提示詞的有效性
- [ ] 測試多個真實食譜網站（YouTube、AllRecipes、Food Network 等）
- [ ] 記錄所有發現的問題（食材遺漏、步驟不完整、營養計算錯誤等）
- [x] 優化網頁內容提取策略：
  - [x] 增加等待時間從 2 秒到 5 秒，確保動態內容完全加載
  - [x] 改進內容選擇器，優先尋找食譜相關區域（article, [class*="recipe"], main 等）
  - [x] 移除廣告和側邊欄內容，提高提取質量
- [x] 改進 AI 提示詞：
  - [x] 強化食材識別的完整性要求（明確要求不要遺漏任何食材）
  - [x] 改進步驟提取的邏輯（要求按順序詳細描述）
  - [x] 優化營養計算的準確性（要求根據實際食材精準計算）
  - [x] 增加內容提取長度從 4000 字符到 10000 字符
- [x] 優化 JSON schema 以確保數據結構完整
- [x] 測試驗證優化效果（所有測試通過）
- [x] 更新文檔並創建 checkpoint

## 解決小紅書等受限網站的內容讀取問題
- [x] 測試小紅書連結並分析具體問題
- [x] 識別需要登入或有反爬蟲機制的網站
- [x] 添加友好的錯誤提示：
  - [x] 明確告知用戶該網站需要登入或有訪問限制
  - [x] 提供替代方案建議（使用圖片上傳或手動輸入）
  - [x] 添加常見受限網站列表（小紅書、抖音、TikTok、YouTube、Bilibili）
- [x] 優化網頁抓取策略：
  - [x] 檢測空白或無效內容
  - [x] 提供更詳細的錯誤信息（區分影片網站和一般受限網站）
  - [x] 改進內容驗證邏輯（檢查內容長度 < 50 字符）
  - [x] 前端顯示更友好的錯誤信息（分離標題和建議）
- [x] 測試驗證並創建 checkpoint（所有測試通過）

## 在用戶建議功能中添加優化後營養成分和健康提示
- [x] 分析當前建議功能的實現
- [x] 改進 AI 提示詞以計算優化後的營養成分（使用結構化輸出 JSON schema）
- [x] 更新數據庫 schema 以儲存優化後營養數據：
  - [x] 添加優化後卡路里字段 (improvedCalories)
  - [x] 添加優化後蛋白質、碳水化合物、脂肪、纖維字段
  - [x] 添加健康提示字段 (healthTips)
  - [x] 推送數據庫更新 (pnpm db:push)
- [x] 更新後端 API 以處理和儲存優化後營養數據
- [x] 更新前端顯示：
  - [x] 顯示改良前後營養成分對比（网格布局）
  - [x] 添加營養變化百分比（緑色↓改善，紅色↑惡化）
  - [x] 顯示健康提示（獨立區塊）
  - [x] 使用顏色標示改善/惡化（卡路里↓緑色，蛋白質↑緑色）
- [x] 測試驗證並創建 checkpoint（所有測試通過）

## 在米芝蓮級改良建議標題中添加 AI 字樣
- [x] 查找「米芝蓮級改良建議」標題的位置
- [x] 將標題改為「米芝蓮級 AI 改良建議」
- [x] 測試驗證並創建 checkpoint

## 實現智能食材替換建議功能
- [x] 設計功能架構和數據流
- [x] 創建後端 API 以生成替換建議：
  - [x] 創建 tRPC 路由 `ingredients.getSuggestions`
  - [x] 使用 AI 結構化輸出生成替換建議
  - [x] 包含營養對比和替換原因
  - [x] 添加 `getIngredientById` 數據庫查詢函數
- [x] 創建前端替換建議對話框：
  - [x] 設計對話框 UI（顯示原食材信息）
  - [x] 顯示 AI 推薦的替換選項
  - [x] 顯示營養成分對比（網格布局）
  - [x] 添加替換原因說明
  - [x] 添加健康益處標籤
- [x] 實現一鍵替換功能：
  - [x] 創建 `ingredients.replace` API
  - [x] 替換食材後重新計算整體營養成分
  - [x] 在 RecipeDetail 頁面中集成替換功能
  - [x] 添加點擊食材查看替換建議的交互
- [x] 測試驗證並創建 checkpoint（所有測試通過）

## 更新系統標題為「Co-Dine 健康飲食食譜管理及分析系統」
- [x] 查找所有顯示系統標題的位置
- [x] 更新首頁標題（Home.tsx）
- [x] 更新瀏覽頁面副標題（Browse.tsx）
- [ ] 需要用戶在管理 UI 中更新 VITE_APP_TITLE 環境變量
- [x] 測試驗證並創建 checkpoint

## 更新首頁宣傳文案，突出核心價值主張
- [x] 分析當前首頁內容結構
- [x] 重寫主標題和副標題：「健康改造傳統菜式，保留風味、精準控制營養」
- [x] 優化三種輸入方式的描述，突出健康改造功能
- [x] 優化 AI 分析功能介紹：「精準計算、清晰對比、保留風味」
- [x] 優化多維度分類系統介紹，突出精準控制
- [x] 測試驗證並創建 checkpoint
